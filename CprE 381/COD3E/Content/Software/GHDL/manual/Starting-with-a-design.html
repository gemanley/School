<html lang="en">

	<head>
		<title>GHDL guide</title>
		<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
		<meta name="description" content="GHDL guide">
		<meta name="generator" content="makeinfo 4.1">
		<link href="http://texinfo.org/" rel="generator-home">
		<link href="../../../resources/base_style.css" rel="stylesheet" type="text/css" media="all">
	</head>

	<body>
		<p>Node:<a name="Starting%20with%20a%20design">Starting with a design</a>, Previous:<a href="A-full-adder.html#A%20full%20adder" rel="previous">A full adder</a>, Up:<a href="Starting-with-GHDL.html#Starting%20with%20GHDL" rel="up">Starting with GHDL</a></p>
		<hr>
		<br>
		<h3>Starting with a design</h3>
		<p>Unless you are only studying VHDL, you will work with bigger designs than the ones of the previous examples.</p>
		<p>Let's see how to analyze and run a bigger design, such as the DLX model suite written by Peter Ashenden which is distributed under the terms of the GNU General Public License.</p>
		<p>First, untar the sources:<br>
		</p>
		<pre>$ tar zxvf dlx.tar.Z
</pre>
		<p>In order not to pollute the sources with the library, it is a good idea to create a <code>work/</code> subdirectory for the <code>WORK</code> library. To any GHDL commands, we will add the <code>--workdir=work</code> option, so that all files generated by the compiler (except the executable) will be placed in this directory.<br>
		</p>
		<pre>$ cd dlx
$ mkdir work
</pre>
		<p>We will run the <code>dlx_test_behaviour</code> design. We need to analyze all the design units for the design hierarchy, in the correct order. GHDL provides an easy way to do this, by importing the sources:<br>
		</p>
		<pre>$ ghdl -i --workdir=work *.vhdl
</pre>
		<p>and making a design:<br>
		</p>
		<pre>$ ghdl -m --workdir=work dlx_test_behaviour
</pre>
		<p>Before this second stage, GHDL knows all the design units of the DLX, but no one have been analyzed. The make mode of GHDL analyzes and elaborates a design. This creates many files in the <code>work/</code> directory, and the <code>dlx_test_behaviour</code> executable in the current directory.</p>
		<p>The simulation needs to have a DLX program contained in the file <code>dlx.out</code>. This memory image will be be loaded in the DLX memory. Just take one sample:<br>
		</p>
		<pre>$ cp test_loop.out dlx.out
</pre>
		<p>And you can run the test suite:<br>
		</p>
		<pre>$ ./dlx_test_behaviour
</pre>
		<p>The test bench monitors the bus and displays each instruction executed. It finishes with an assertion of severity level note:<br>
		</p>
		<pre>dlx-behaviour.vhdl:395:11:(assertion note): TRAP instruction
 encountered, execution halted
</pre>
		<p>Since the clock is still running, you have to manually stop the program with the <kbd>C-c</kbd> key sequence. This behavior prevents you from running the test bench in batch mode. However, you may force the simulator to stop when an assertion above or equal a certain severity level occurs:<br>
		</p>
		<pre>$ ./dlx_test_behaviour --assert-level=note
</pre>
		<p>With this option, the program stops just after the previous message:<br>
		</p>
		<pre>dlx-behaviour.vhdl:395:11:(assertion note): TRAP instruction
 encountered, execution halted
error: assertion failed
</pre>
		<p>If you want to make room on your hard drive, you can either:</p>
		<ul>
			<li>clean the design library with the GHDL command:<br>
				<pre>$ ghdl --clean --workdir=work
</pre>
				This removes the executable and all the object files. If you want to rebuild the design at this point, just do the make command as shown above.
			<li>remove the design library with the GHDL command:<br>
				<pre>$ ghdl --remove --workdir=work
</pre>
				This removes the executable, all the object files and the library file. If you want to rebuild the design, you have to import the sources again, and to make the design.
			<li>remove the <code>work/</code> directory:<br>
				<pre>$ rm -rf work
</pre>
				Only the executable is kept. If you want to rebuild the design, create the <code>work/</code> directory, import the sources, and make the design.
		</ul>
	</body>

</html>